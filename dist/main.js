!function(n){var t={};function e(g){if(t[g])return t[g].exports;var i=t[g]={i:g,l:!1,exports:{}};return n[g].call(i.exports,i,i.exports,e),i.l=!0,i.exports}e.m=n,e.c=t,e.d=function(n,t,g){e.o(n,t)||Object.defineProperty(n,t,{configurable:!1,enumerable:!0,get:g})},e.r=function(n){Object.defineProperty(n,"__esModule",{value:!0})},e.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(t,"a",t),t},e.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},e.p="",e(e.s=0)}([function(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n\n// EXTERNAL MODULE: ./src/styles/index.css\nvar styles = __webpack_require__(2);\n\n// CONCATENATED MODULE: ./src/asset_manager.js\n\n\nconst Assets = (function() {\n  let assets = {};\n\n  function loadAssets(assetOwners, callback) {\n    let tempAssetPaths = [];\n    for (let assetOwner of assetOwners) {\n      tempAssetPaths = tempAssetPaths.concat(assetOwner.assetPaths);\n    }\n    let assetPaths = [...new Set(tempAssetPaths)];\n\n    let assetsRemaining = assetPaths.length;\n    for (let assetPath of assetPaths) {\n      let asset = new Image();\n      asset.onload = function() {\n        assets[assetPath] = asset;\n        assetsRemaining--;\n        if (assetsRemaining <= 0) {\n          callback();\n        }\n      };\n      asset.src = assetPath;\n    }\n  }\n\n  function get(assetPath) {\n    return assets[assetPath];\n  }\n\n  return {\n    loadAssets: loadAssets,\n    get: get\n  };\n})();\n\n// CONCATENATED MODULE: ./src/asset_owner.js\n\n\n\nclass AssetOwner {\n\n  constructor(assetPaths) {\n    this.assetPaths = assetPaths;\n  }\n\n}\n\n// CONCATENATED MODULE: ./src/tile.js\n\n\n\n\n\n\nclass tile_Tile extends AssetOwner {\n\n  constructor(assetPaths) {\n    super(assetPaths);\n    this.tileWidth = 128;\n    this.tileHeight = 64;\n    this.imageFrameIndex = 0;\n  }\n\n  get img() {\n    return Assets.get(this.assetPaths[this.imageFrameIndex]);\n  }\n\n}\n\n// CONCATENATED MODULE: ./src/util.js\n\n\nconst tileImagePaths = [\n  './src/img/ground_tiles/brickpavers2.png',\n  './src/img/ground_tiles/concrete368a.png',\n  './src/img/ground_tiles/cretebrick970.png',\n  './src/img/ground_tiles/dirt.png',\n  './src/img/ground_tiles/dirtsand2.png',\n  './src/img/ground_tiles/rock.png',\n  './src/img/ground_tiles/snow.png',\n  './src/img/ground_tiles/stone.png'\n];\n\nconst mobileDefs = [\n  {\n    imagePaths: ['./src/img/mobiles/8way_mobile.png'],\n    startTile: { x: 3, y: 3 }\n  },\n  {\n    imagePaths: ['./src/img/mobiles/8way_mobile.png'],\n    startTile: { x: 5, y: 4 }\n  },\n  {\n    imagePaths: ['./src/img/mobiles/8way_mobile.png'],\n    startTile: { x: 3, y: 6 }\n  }\n];\n\nconst mobileSpritePaths = ['./src/img/mobiles/8way_mobile.png'];\n\nconst rand = max => {\n  return Math.floor(Math.random() * Math.floor(max));\n};\n\nconst coordsEqual = (a, b) => {\n  return a.x == b.x && a.y == b.y;\n};\n\n// CONCATENATED MODULE: ./src/map.js\n\n\n\n\n\nclass Map {\n\n  constructor(tiles, mapSize) {\n    this.tiles = tiles;\n    this.mapSize = mapSize;\n    this.tileWidth = tiles[0].tileWidth;\n    this.tileHeight = tiles[0].tileHeight;\n    this.mapDef = buildMapDef(this);\n  }\n\n  get mapCanvas() {\n    if (this.myMapCanvas == undefined) {\n      this.myMapCanvas = drawMapCanvas(this);\n    }\n    return this.myMapCanvas;\n  }\n\n  mapCoordsForTile(tileCoords) {\n    let xOffset = ((this.mapSize * this.tileWidth) / 2) - (this.tileWidth / 2);\n    let mapX = ((tileCoords.x - tileCoords.y) * (this.tileWidth / 2)) + xOffset;\n    let mapY = (tileCoords.x + tileCoords.y) * (this.tileHeight / 2);\n    return {x: mapX, y: mapY};\n  }\n\n  tileOffsets() {\n    return { x: this.tileWidth / 2, y: this.tileHeight / 2 };\n  }\n\n};\n\nfunction buildMapDef(map) {\n  let mapDef = [];\n  for (let i = 0; i < map.mapSize; i++) {\n    mapDef[i] = [];\n    for (let j = 0; j < map.mapSize; j++) {\n      mapDef[i][j] = map.tiles[rand(map.tiles.length)];\n    }\n  }\n  return mapDef;\n}\n\nfunction drawMapCanvas(map) {\n  let mapCanvas = document.createElement(\"canvas\");\n  mapCanvas.width = map.mapSize * map.tileWidth - map.mapSize;\n  mapCanvas.height = map.mapSize * map.tileHeight - map.mapSize;\n\n  for (let [x, row] of map.mapDef.entries()) {\n    for (let [y, tile] of row.entries()) {\n      drawTile(map, mapCanvas.getContext(\"2d\"), tile, x, y);\n    }\n  }\n  return mapCanvas;\n}\n\nfunction drawTile(map, context, tile, mapX, mapY) {\n  let contextCoords = map.mapCoordsForTile({x: mapX, y: mapY});\n  context.drawImage(tile.img, contextCoords.x, contextCoords.y, map.tileWidth, map.tileHeight);\n}\n\n\n// CONCATENATED MODULE: ./src/entity.js\n\n\n\n\n\n\nclass entity_Entity extends AssetOwner {\n  constructor(entityDef, map) {\n    super(entityDef.imagePaths);\n    this.frameWidth = 60;\n    this.frameHeight = 110;\n    this.map = map;\n    this.currentTile = {\n      x: entityDef.startTile === undefined ? 0 : entityDef.startTile.x,\n      y: entityDef.startTile === undefined ? 0 : entityDef.startTile.y\n    };\n    this.location = this.findMapPositionForTile(this.currentTile);\n    this.tilePath = [];\n    this.destination = undefined;\n  }\n\n  get image() {\n    return Assets.get(this.assetPaths[0]);\n  }\n\n  get frameXOrigin() {\n    return 0;\n  }\n\n  get frameYOrigin() {\n    return 0;\n  }\n\n  respondToMouse(event) {\n    if (event != undefined && event.tileCoords != undefined) {\n      this.tilePath = buildTilePath(this.currentTile, event.tileCoords);\n      this.updateDestination();\n    }\n  }\n\n  tick() {\n    if (this.destination != undefined) {\n      let dx = this.location.x - this.destination.x,\n        dy = this.location.y - this.destination.y;\n      let dist = Math.sqrt(dx * dx + dy * dy);\n      let velX = (dx / dist) * 5;\n      let velY = (dy / dist) * 5;\n      if (Math.abs(dx) < Math.abs(velX)) {\n        velX = dx;\n      }\n      if (Math.abs(dy) < Math.abs(velY)) {\n        velY = dy;\n      }\n      this.location.x -= velX;\n      this.location.y -= velY;\n      if (coordsEqual(this.location, this.destination)) {\n        this.currentTile = this.tilePath.shift();\n        this.updateDestination();\n      }\n    }\n  }\n\n  updateDestination() {\n    let nextTileDestination = this.tilePath[0];\n    if (nextTileDestination != undefined) {\n      this.destination = this.findMapPositionForTile(nextTileDestination);\n    } else {\n      this.destination = undefined;\n    }\n  }\n\n  findMapPositionForTile(tile) {\n    let mapDestination = this.map.mapCoordsForTile({ x: tile.x, y: tile.y });\n    let tileOffset = this.map.tileOffsets();\n    let frameOffset = { x: this.frameWidth / 2, y: this.frameHeight };\n    return {\n      x: mapDestination.x + tileOffset.x - frameOffset.x,\n      y: mapDestination.y + tileOffset.y - frameOffset.y\n    };\n  }\n}\n\n// Uses Brensenham's line algorithm\nfunction buildTilePath(start, end) {\n  let path = [];\n\n  let currentX = start.x,\n    currentY = start.y;\n  let deltaX = Math.abs(end.x - start.x),\n    deltaY = Math.abs(end.y - start.y);\n  let slopeX = start.x < end.x ? 1 : -1,\n    slopeY = start.y < end.y ? 1 : -1;\n  let err = deltaX - deltaY;\n\n  while (currentX != end.x || currentY != end.y) {\n    let err2 = 2 * err;\n    if (err2 > deltaY * -1) {\n      err -= deltaY;\n      currentX += slopeX;\n    } else if (err2 < deltaX) {\n      err += deltaX;\n      currentY += slopeY;\n    }\n    path.push({ x: currentX, y: currentY });\n  }\n  return path;\n}\n\n// CONCATENATED MODULE: ./src/input.js\n\n\n\nconst Input = (function() {\n\n  let keysDown = [];\n  let keysPressed = [];\n  let mouseEventPoint = undefined;\n\n  function keyDown(keyCode) {\n    if (keysPressed.indexOf(keyCode) < 0) {\n      keysPressed.push(keyCode);\n    }\n    if (keysDown.indexOf(keyCode) < 0) {\n      keysDown.push(keyCode);\n    }\n  }\n\n  function keyUp(keyCode) {\n    keysDown = keysDown.filter( (element) => {\n      return element != keyCode;\n    });\n  }\n\n  function getKeysPressed() {\n    return keysDown.concat(keysPressed.filter( (key) => {\n      return keysDown.indexOf(key) < 0;\n    }));\n  }\n\n  function mouseUp(point) {\n    mouseEventPoint = point;\n  }\n\n  function getMouseEvent() {\n    return mouseEventPoint;\n  }\n\n  function resetInputs() {\n    keysPressed = [];\n    mouseEventPoint = undefined;\n  }\n\n  return {\n    keyDown: keyDown,\n    keyUp: keyUp,\n    getKeysPressed: getKeysPressed,\n    mouseUp: mouseUp,\n    getMouseEvent: getMouseEvent,\n    resetInputs: resetInputs\n  }\n\n})();\n\n// CONCATENATED MODULE: ./src/index.js\n\n\n\n\n\n\n\n\n\n\n\ndocument.addEventListener('DOMContentLoaded', function() {\n  console.log('Proxma Reverie approaches!');\n\n  let tickLength = 50;\n\n  var viewport = document.getElementById('viewport-canvas');\n  var viewportContext = viewport.getContext('2d');\n  let viewportWidth = 600,\n    viewportHeight = 400;\n  viewport.width = viewportWidth;\n  viewport.height = viewportHeight;\n\n  let mapSize = 10;\n\n  let tiles = tileImagePaths.map(tileImagePath => {\n    return new tile_Tile([tileImagePath]);\n  });\n\n  let map = new Map(tiles, mapSize);\n\n  let mobiles = mobileDefs.map(mobileDef => {\n    return new entity_Entity(mobileDef, map);\n  });\n\n  console.log(mobiles);\n\n  Assets.loadAssets([...tiles, ...mobiles], () => {\n    document.getElementById('loading-images-message').classList.add('hide');\n    document.getElementById('images-loaded-message').classList.remove('hide');\n\n    setTimeout(() => {\n      let viewOffsetX = map.mapCanvas.width / 2 - viewportWidth / 2;\n      let viewOffsetY = map.mapCanvas.height / 2 - viewportHeight / 2;\n\n      doTick(map, viewOffsetX, viewOffsetY);\n    }, tickLength);\n  });\n\n  function doTick(map, viewOffsetX, viewOffsetY) {\n    // console.log('tick');\n\n    let mouseEvent = Input.getMouseEvent();\n    if (mouseEvent != undefined) {\n      let mapPosition = getCursorMapPosition(\n        viewOffsetX,\n        viewOffsetY,\n        mouseEvent\n      );\n      let tilePosition = getCursorTilePosition(map, mapPosition);\n      // console.log(\"\");\n      // console.log(`canvas position: ${mouseEvent.x}, ${mouseEvent.y}`);\n      // console.log(`map position: ${mapPosition.x}, ${mapPosition.y}`);\n      // console.log(`tile position: ${tilePosition.x}, ${tilePosition.y}`);\n      // console.log(\"\");\n\n      mobiles.forEach(mobile => {\n        mobile.respondToMouse({\n          mapCoord: mapPosition,\n          tileCoords: tilePosition\n        });\n      });\n    }\n\n    mobiles.forEach(mobile => {\n      mobile.tick();\n    });\n\n    viewportContext.clearRect(0, 0, viewportWidth, viewportHeight);\n    viewportContext.drawImage(\n      map.mapCanvas,\n      viewOffsetX,\n      viewOffsetY,\n      viewportWidth,\n      viewportHeight,\n      0,\n      0,\n      viewportWidth,\n      viewportHeight\n    );\n\n    mobiles.forEach(mobile => {\n      viewportContext.drawImage(\n        mobile.image,\n        mobile.frameXOrigin,\n        mobile.frameYOrigin,\n        mobile.frameWidth,\n        mobile.frameHeight,\n        mobile.location.x - viewOffsetX,\n        mobile.location.y - viewOffsetY,\n        mobile.frameWidth,\n        mobile.frameHeight\n      );\n    });\n\n    Input.resetInputs();\n\n    setTimeout(() => {\n      doTick(map, viewOffsetX, viewOffsetY);\n    }, tickLength);\n  }\n\n  document.addEventListener('keydown', event => {\n    Input.keyDown(event.key);\n  });\n\n  document.addEventListener('keyup', event => {\n    Input.keyUp(event.key);\n  });\n\n  viewport.addEventListener('mouseup', event => {\n    Input.mouseUp(getCursorCanvasPosition(viewport, event));\n  });\n\n  function getCursorCanvasPosition(canvas, position) {\n    let rect = canvas.getBoundingClientRect();\n    let x = position.clientX - rect.left;\n    let y = position.clientY - rect.top;\n    return { x: x, y: y };\n  }\n\n  function getCursorMapPosition(viewOffsetX, viewOffsetY, position) {\n    let mouseMapX = viewOffsetX + position.x;\n    let mouseMapY = viewOffsetY + position.y;\n    return { x: mouseMapX, y: mouseMapY };\n  }\n\n  function getCursorTilePosition(map, position) {\n    let halfTileWidth = map.tileWidth / 2;\n    let halfTileHeight = map.tileHeight / 2;\n    let halfMapSize = map.mapSize / 2;\n    let tileX =\n      (position.x / halfTileWidth + position.y / halfTileHeight) / 2 -\n      halfMapSize;\n    let tileY =\n      (position.y / halfTileHeight - position.x / halfTileWidth) / 2 +\n      halfMapSize;\n    return { x: Math.floor(tileX), y: Math.floor(tileY) };\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9hc3NldF9tYW5hZ2VyLmpzP2FlMGMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2Fzc2V0X293bmVyLmpzPzc0YTIiLCJ3ZWJwYWNrOi8vLy4vc3JjL3RpbGUuanM/MGM4MCIsIndlYnBhY2s6Ly8vLi9zcmMvdXRpbC5qcz9lMGViIiwid2VicGFjazovLy8uL3NyYy9tYXAuanM/MThiYSIsIndlYnBhY2s6Ly8vLi9zcmMvZW50aXR5LmpzPzYyN2EiLCJ3ZWJwYWNrOi8vLy4vc3JjL2lucHV0LmpzPzllZjgiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LmpzP2I2MzUiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5leHBvcnQgY29uc3QgQXNzZXRzID0gKGZ1bmN0aW9uKCkge1xuICBsZXQgYXNzZXRzID0ge307XG5cbiAgZnVuY3Rpb24gbG9hZEFzc2V0cyhhc3NldE93bmVycywgY2FsbGJhY2spIHtcbiAgICBsZXQgdGVtcEFzc2V0UGF0aHMgPSBbXTtcbiAgICBmb3IgKGxldCBhc3NldE93bmVyIG9mIGFzc2V0T3duZXJzKSB7XG4gICAgICB0ZW1wQXNzZXRQYXRocyA9IHRlbXBBc3NldFBhdGhzLmNvbmNhdChhc3NldE93bmVyLmFzc2V0UGF0aHMpO1xuICAgIH1cbiAgICBsZXQgYXNzZXRQYXRocyA9IFsuLi5uZXcgU2V0KHRlbXBBc3NldFBhdGhzKV07XG5cbiAgICBsZXQgYXNzZXRzUmVtYWluaW5nID0gYXNzZXRQYXRocy5sZW5ndGg7XG4gICAgZm9yIChsZXQgYXNzZXRQYXRoIG9mIGFzc2V0UGF0aHMpIHtcbiAgICAgIGxldCBhc3NldCA9IG5ldyBJbWFnZSgpO1xuICAgICAgYXNzZXQub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGFzc2V0c1thc3NldFBhdGhdID0gYXNzZXQ7XG4gICAgICAgIGFzc2V0c1JlbWFpbmluZy0tO1xuICAgICAgICBpZiAoYXNzZXRzUmVtYWluaW5nIDw9IDApIHtcbiAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgYXNzZXQuc3JjID0gYXNzZXRQYXRoO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGdldChhc3NldFBhdGgpIHtcbiAgICByZXR1cm4gYXNzZXRzW2Fzc2V0UGF0aF07XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGxvYWRBc3NldHM6IGxvYWRBc3NldHMsXG4gICAgZ2V0OiBnZXRcbiAgfTtcbn0pKCk7XG4iLCJcblwidXNlIHN0cmljdFwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBc3NldE93bmVyIHtcblxuICBjb25zdHJ1Y3Rvcihhc3NldFBhdGhzKSB7XG4gICAgdGhpcy5hc3NldFBhdGhzID0gYXNzZXRQYXRocztcbiAgfVxuXG59XG4iLCJcblwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgeyBBc3NldHMgfSBmcm9tIFwiLi9hc3NldF9tYW5hZ2VyXCI7XG5pbXBvcnQgQXNzZXRPd25lciBmcm9tIFwiLi9hc3NldF9vd25lclwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUaWxlIGV4dGVuZHMgQXNzZXRPd25lciB7XG5cbiAgY29uc3RydWN0b3IoYXNzZXRQYXRocykge1xuICAgIHN1cGVyKGFzc2V0UGF0aHMpO1xuICAgIHRoaXMudGlsZVdpZHRoID0gMTI4O1xuICAgIHRoaXMudGlsZUhlaWdodCA9IDY0O1xuICAgIHRoaXMuaW1hZ2VGcmFtZUluZGV4ID0gMDtcbiAgfVxuXG4gIGdldCBpbWcoKSB7XG4gICAgcmV0dXJuIEFzc2V0cy5nZXQodGhpcy5hc3NldFBhdGhzW3RoaXMuaW1hZ2VGcmFtZUluZGV4XSk7XG4gIH1cblxufVxuIiwiJ3VzZSBzdHJpY3QnO1xuXG5leHBvcnQgY29uc3QgdGlsZUltYWdlUGF0aHMgPSBbXG4gICcuL3NyYy9pbWcvZ3JvdW5kX3RpbGVzL2JyaWNrcGF2ZXJzMi5wbmcnLFxuICAnLi9zcmMvaW1nL2dyb3VuZF90aWxlcy9jb25jcmV0ZTM2OGEucG5nJyxcbiAgJy4vc3JjL2ltZy9ncm91bmRfdGlsZXMvY3JldGVicmljazk3MC5wbmcnLFxuICAnLi9zcmMvaW1nL2dyb3VuZF90aWxlcy9kaXJ0LnBuZycsXG4gICcuL3NyYy9pbWcvZ3JvdW5kX3RpbGVzL2RpcnRzYW5kMi5wbmcnLFxuICAnLi9zcmMvaW1nL2dyb3VuZF90aWxlcy9yb2NrLnBuZycsXG4gICcuL3NyYy9pbWcvZ3JvdW5kX3RpbGVzL3Nub3cucG5nJyxcbiAgJy4vc3JjL2ltZy9ncm91bmRfdGlsZXMvc3RvbmUucG5nJ1xuXTtcblxuZXhwb3J0IGNvbnN0IG1vYmlsZURlZnMgPSBbXG4gIHtcbiAgICBpbWFnZVBhdGhzOiBbJy4vc3JjL2ltZy9tb2JpbGVzLzh3YXlfbW9iaWxlLnBuZyddLFxuICAgIHN0YXJ0VGlsZTogeyB4OiAzLCB5OiAzIH1cbiAgfSxcbiAge1xuICAgIGltYWdlUGF0aHM6IFsnLi9zcmMvaW1nL21vYmlsZXMvOHdheV9tb2JpbGUucG5nJ10sXG4gICAgc3RhcnRUaWxlOiB7IHg6IDUsIHk6IDQgfVxuICB9LFxuICB7XG4gICAgaW1hZ2VQYXRoczogWycuL3NyYy9pbWcvbW9iaWxlcy84d2F5X21vYmlsZS5wbmcnXSxcbiAgICBzdGFydFRpbGU6IHsgeDogMywgeTogNiB9XG4gIH1cbl07XG5cbmV4cG9ydCBjb25zdCBtb2JpbGVTcHJpdGVQYXRocyA9IFsnLi9zcmMvaW1nL21vYmlsZXMvOHdheV9tb2JpbGUucG5nJ107XG5cbmV4cG9ydCBjb25zdCByYW5kID0gbWF4ID0+IHtcbiAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIE1hdGguZmxvb3IobWF4KSk7XG59O1xuXG5leHBvcnQgY29uc3QgY29vcmRzRXF1YWwgPSAoYSwgYikgPT4ge1xuICByZXR1cm4gYS54ID09IGIueCAmJiBhLnkgPT0gYi55O1xufTtcbiIsIlxuXCJ1c2Ugc3RyaWN0XCI7XG5cbmltcG9ydCB7IHJhbmQgfSBmcm9tIFwiLi91dGlsXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1hcCB7XG5cbiAgY29uc3RydWN0b3IodGlsZXMsIG1hcFNpemUpIHtcbiAgICB0aGlzLnRpbGVzID0gdGlsZXM7XG4gICAgdGhpcy5tYXBTaXplID0gbWFwU2l6ZTtcbiAgICB0aGlzLnRpbGVXaWR0aCA9IHRpbGVzWzBdLnRpbGVXaWR0aDtcbiAgICB0aGlzLnRpbGVIZWlnaHQgPSB0aWxlc1swXS50aWxlSGVpZ2h0O1xuICAgIHRoaXMubWFwRGVmID0gYnVpbGRNYXBEZWYodGhpcyk7XG4gIH1cblxuICBnZXQgbWFwQ2FudmFzKCkge1xuICAgIGlmICh0aGlzLm15TWFwQ2FudmFzID09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5teU1hcENhbnZhcyA9IGRyYXdNYXBDYW52YXModGhpcyk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLm15TWFwQ2FudmFzO1xuICB9XG5cbiAgbWFwQ29vcmRzRm9yVGlsZSh0aWxlQ29vcmRzKSB7XG4gICAgbGV0IHhPZmZzZXQgPSAoKHRoaXMubWFwU2l6ZSAqIHRoaXMudGlsZVdpZHRoKSAvIDIpIC0gKHRoaXMudGlsZVdpZHRoIC8gMik7XG4gICAgbGV0IG1hcFggPSAoKHRpbGVDb29yZHMueCAtIHRpbGVDb29yZHMueSkgKiAodGhpcy50aWxlV2lkdGggLyAyKSkgKyB4T2Zmc2V0O1xuICAgIGxldCBtYXBZID0gKHRpbGVDb29yZHMueCArIHRpbGVDb29yZHMueSkgKiAodGhpcy50aWxlSGVpZ2h0IC8gMik7XG4gICAgcmV0dXJuIHt4OiBtYXBYLCB5OiBtYXBZfTtcbiAgfVxuXG4gIHRpbGVPZmZzZXRzKCkge1xuICAgIHJldHVybiB7IHg6IHRoaXMudGlsZVdpZHRoIC8gMiwgeTogdGhpcy50aWxlSGVpZ2h0IC8gMiB9O1xuICB9XG5cbn07XG5cbmZ1bmN0aW9uIGJ1aWxkTWFwRGVmKG1hcCkge1xuICBsZXQgbWFwRGVmID0gW107XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgbWFwLm1hcFNpemU7IGkrKykge1xuICAgIG1hcERlZltpXSA9IFtdO1xuICAgIGZvciAobGV0IGogPSAwOyBqIDwgbWFwLm1hcFNpemU7IGorKykge1xuICAgICAgbWFwRGVmW2ldW2pdID0gbWFwLnRpbGVzW3JhbmQobWFwLnRpbGVzLmxlbmd0aCldO1xuICAgIH1cbiAgfVxuICByZXR1cm4gbWFwRGVmO1xufVxuXG5mdW5jdGlvbiBkcmF3TWFwQ2FudmFzKG1hcCkge1xuICBsZXQgbWFwQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgbWFwQ2FudmFzLndpZHRoID0gbWFwLm1hcFNpemUgKiBtYXAudGlsZVdpZHRoIC0gbWFwLm1hcFNpemU7XG4gIG1hcENhbnZhcy5oZWlnaHQgPSBtYXAubWFwU2l6ZSAqIG1hcC50aWxlSGVpZ2h0IC0gbWFwLm1hcFNpemU7XG5cbiAgZm9yIChsZXQgW3gsIHJvd10gb2YgbWFwLm1hcERlZi5lbnRyaWVzKCkpIHtcbiAgICBmb3IgKGxldCBbeSwgdGlsZV0gb2Ygcm93LmVudHJpZXMoKSkge1xuICAgICAgZHJhd1RpbGUobWFwLCBtYXBDYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpLCB0aWxlLCB4LCB5KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG1hcENhbnZhcztcbn1cblxuZnVuY3Rpb24gZHJhd1RpbGUobWFwLCBjb250ZXh0LCB0aWxlLCBtYXBYLCBtYXBZKSB7XG4gIGxldCBjb250ZXh0Q29vcmRzID0gbWFwLm1hcENvb3Jkc0ZvclRpbGUoe3g6IG1hcFgsIHk6IG1hcFl9KTtcbiAgY29udGV4dC5kcmF3SW1hZ2UodGlsZS5pbWcsIGNvbnRleHRDb29yZHMueCwgY29udGV4dENvb3Jkcy55LCBtYXAudGlsZVdpZHRoLCBtYXAudGlsZUhlaWdodCk7XG59XG5cbiIsIid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHsgQXNzZXRzIH0gZnJvbSAnLi9hc3NldF9tYW5hZ2VyJztcbmltcG9ydCBBc3NldE93bmVyIGZyb20gJy4vYXNzZXRfb3duZXInO1xuaW1wb3J0IHsgY29vcmRzRXF1YWwgfSBmcm9tICcuL3V0aWwnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBFbnRpdHkgZXh0ZW5kcyBBc3NldE93bmVyIHtcbiAgY29uc3RydWN0b3IoZW50aXR5RGVmLCBtYXApIHtcbiAgICBzdXBlcihlbnRpdHlEZWYuaW1hZ2VQYXRocyk7XG4gICAgdGhpcy5mcmFtZVdpZHRoID0gNjA7XG4gICAgdGhpcy5mcmFtZUhlaWdodCA9IDExMDtcbiAgICB0aGlzLm1hcCA9IG1hcDtcbiAgICB0aGlzLmN1cnJlbnRUaWxlID0ge1xuICAgICAgeDogZW50aXR5RGVmLnN0YXJ0VGlsZSA9PT0gdW5kZWZpbmVkID8gMCA6IGVudGl0eURlZi5zdGFydFRpbGUueCxcbiAgICAgIHk6IGVudGl0eURlZi5zdGFydFRpbGUgPT09IHVuZGVmaW5lZCA/IDAgOiBlbnRpdHlEZWYuc3RhcnRUaWxlLnlcbiAgICB9O1xuICAgIHRoaXMubG9jYXRpb24gPSB0aGlzLmZpbmRNYXBQb3NpdGlvbkZvclRpbGUodGhpcy5jdXJyZW50VGlsZSk7XG4gICAgdGhpcy50aWxlUGF0aCA9IFtdO1xuICAgIHRoaXMuZGVzdGluYXRpb24gPSB1bmRlZmluZWQ7XG4gIH1cblxuICBnZXQgaW1hZ2UoKSB7XG4gICAgcmV0dXJuIEFzc2V0cy5nZXQodGhpcy5hc3NldFBhdGhzWzBdKTtcbiAgfVxuXG4gIGdldCBmcmFtZVhPcmlnaW4oKSB7XG4gICAgcmV0dXJuIDA7XG4gIH1cblxuICBnZXQgZnJhbWVZT3JpZ2luKCkge1xuICAgIHJldHVybiAwO1xuICB9XG5cbiAgcmVzcG9uZFRvTW91c2UoZXZlbnQpIHtcbiAgICBpZiAoZXZlbnQgIT0gdW5kZWZpbmVkICYmIGV2ZW50LnRpbGVDb29yZHMgIT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aGlzLnRpbGVQYXRoID0gYnVpbGRUaWxlUGF0aCh0aGlzLmN1cnJlbnRUaWxlLCBldmVudC50aWxlQ29vcmRzKTtcbiAgICAgIHRoaXMudXBkYXRlRGVzdGluYXRpb24oKTtcbiAgICB9XG4gIH1cblxuICB0aWNrKCkge1xuICAgIGlmICh0aGlzLmRlc3RpbmF0aW9uICE9IHVuZGVmaW5lZCkge1xuICAgICAgbGV0IGR4ID0gdGhpcy5sb2NhdGlvbi54IC0gdGhpcy5kZXN0aW5hdGlvbi54LFxuICAgICAgICBkeSA9IHRoaXMubG9jYXRpb24ueSAtIHRoaXMuZGVzdGluYXRpb24ueTtcbiAgICAgIGxldCBkaXN0ID0gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KTtcbiAgICAgIGxldCB2ZWxYID0gKGR4IC8gZGlzdCkgKiA1O1xuICAgICAgbGV0IHZlbFkgPSAoZHkgLyBkaXN0KSAqIDU7XG4gICAgICBpZiAoTWF0aC5hYnMoZHgpIDwgTWF0aC5hYnModmVsWCkpIHtcbiAgICAgICAgdmVsWCA9IGR4O1xuICAgICAgfVxuICAgICAgaWYgKE1hdGguYWJzKGR5KSA8IE1hdGguYWJzKHZlbFkpKSB7XG4gICAgICAgIHZlbFkgPSBkeTtcbiAgICAgIH1cbiAgICAgIHRoaXMubG9jYXRpb24ueCAtPSB2ZWxYO1xuICAgICAgdGhpcy5sb2NhdGlvbi55IC09IHZlbFk7XG4gICAgICBpZiAoY29vcmRzRXF1YWwodGhpcy5sb2NhdGlvbiwgdGhpcy5kZXN0aW5hdGlvbikpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50VGlsZSA9IHRoaXMudGlsZVBhdGguc2hpZnQoKTtcbiAgICAgICAgdGhpcy51cGRhdGVEZXN0aW5hdGlvbigpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHVwZGF0ZURlc3RpbmF0aW9uKCkge1xuICAgIGxldCBuZXh0VGlsZURlc3RpbmF0aW9uID0gdGhpcy50aWxlUGF0aFswXTtcbiAgICBpZiAobmV4dFRpbGVEZXN0aW5hdGlvbiAhPSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMuZGVzdGluYXRpb24gPSB0aGlzLmZpbmRNYXBQb3NpdGlvbkZvclRpbGUobmV4dFRpbGVEZXN0aW5hdGlvbik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZGVzdGluYXRpb24gPSB1bmRlZmluZWQ7XG4gICAgfVxuICB9XG5cbiAgZmluZE1hcFBvc2l0aW9uRm9yVGlsZSh0aWxlKSB7XG4gICAgbGV0IG1hcERlc3RpbmF0aW9uID0gdGhpcy5tYXAubWFwQ29vcmRzRm9yVGlsZSh7IHg6IHRpbGUueCwgeTogdGlsZS55IH0pO1xuICAgIGxldCB0aWxlT2Zmc2V0ID0gdGhpcy5tYXAudGlsZU9mZnNldHMoKTtcbiAgICBsZXQgZnJhbWVPZmZzZXQgPSB7IHg6IHRoaXMuZnJhbWVXaWR0aCAvIDIsIHk6IHRoaXMuZnJhbWVIZWlnaHQgfTtcbiAgICByZXR1cm4ge1xuICAgICAgeDogbWFwRGVzdGluYXRpb24ueCArIHRpbGVPZmZzZXQueCAtIGZyYW1lT2Zmc2V0LngsXG4gICAgICB5OiBtYXBEZXN0aW5hdGlvbi55ICsgdGlsZU9mZnNldC55IC0gZnJhbWVPZmZzZXQueVxuICAgIH07XG4gIH1cbn1cblxuLy8gVXNlcyBCcmVuc2VuaGFtJ3MgbGluZSBhbGdvcml0aG1cbmZ1bmN0aW9uIGJ1aWxkVGlsZVBhdGgoc3RhcnQsIGVuZCkge1xuICBsZXQgcGF0aCA9IFtdO1xuXG4gIGxldCBjdXJyZW50WCA9IHN0YXJ0LngsXG4gICAgY3VycmVudFkgPSBzdGFydC55O1xuICBsZXQgZGVsdGFYID0gTWF0aC5hYnMoZW5kLnggLSBzdGFydC54KSxcbiAgICBkZWx0YVkgPSBNYXRoLmFicyhlbmQueSAtIHN0YXJ0LnkpO1xuICBsZXQgc2xvcGVYID0gc3RhcnQueCA8IGVuZC54ID8gMSA6IC0xLFxuICAgIHNsb3BlWSA9IHN0YXJ0LnkgPCBlbmQueSA/IDEgOiAtMTtcbiAgbGV0IGVyciA9IGRlbHRhWCAtIGRlbHRhWTtcblxuICB3aGlsZSAoY3VycmVudFggIT0gZW5kLnggfHwgY3VycmVudFkgIT0gZW5kLnkpIHtcbiAgICBsZXQgZXJyMiA9IDIgKiBlcnI7XG4gICAgaWYgKGVycjIgPiBkZWx0YVkgKiAtMSkge1xuICAgICAgZXJyIC09IGRlbHRhWTtcbiAgICAgIGN1cnJlbnRYICs9IHNsb3BlWDtcbiAgICB9IGVsc2UgaWYgKGVycjIgPCBkZWx0YVgpIHtcbiAgICAgIGVyciArPSBkZWx0YVg7XG4gICAgICBjdXJyZW50WSArPSBzbG9wZVk7XG4gICAgfVxuICAgIHBhdGgucHVzaCh7IHg6IGN1cnJlbnRYLCB5OiBjdXJyZW50WSB9KTtcbiAgfVxuICByZXR1cm4gcGF0aDtcbn1cbiIsIlxuXCJ1c2Ugc3RyaWN0XCI7XG5cbmV4cG9ydCBjb25zdCBJbnB1dCA9IChmdW5jdGlvbigpIHtcblxuICBsZXQga2V5c0Rvd24gPSBbXTtcbiAgbGV0IGtleXNQcmVzc2VkID0gW107XG4gIGxldCBtb3VzZUV2ZW50UG9pbnQgPSB1bmRlZmluZWQ7XG5cbiAgZnVuY3Rpb24ga2V5RG93bihrZXlDb2RlKSB7XG4gICAgaWYgKGtleXNQcmVzc2VkLmluZGV4T2Yoa2V5Q29kZSkgPCAwKSB7XG4gICAgICBrZXlzUHJlc3NlZC5wdXNoKGtleUNvZGUpO1xuICAgIH1cbiAgICBpZiAoa2V5c0Rvd24uaW5kZXhPZihrZXlDb2RlKSA8IDApIHtcbiAgICAgIGtleXNEb3duLnB1c2goa2V5Q29kZSk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24ga2V5VXAoa2V5Q29kZSkge1xuICAgIGtleXNEb3duID0ga2V5c0Rvd24uZmlsdGVyKCAoZWxlbWVudCkgPT4ge1xuICAgICAgcmV0dXJuIGVsZW1lbnQgIT0ga2V5Q29kZTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldEtleXNQcmVzc2VkKCkge1xuICAgIHJldHVybiBrZXlzRG93bi5jb25jYXQoa2V5c1ByZXNzZWQuZmlsdGVyKCAoa2V5KSA9PiB7XG4gICAgICByZXR1cm4ga2V5c0Rvd24uaW5kZXhPZihrZXkpIDwgMDtcbiAgICB9KSk7XG4gIH1cblxuICBmdW5jdGlvbiBtb3VzZVVwKHBvaW50KSB7XG4gICAgbW91c2VFdmVudFBvaW50ID0gcG9pbnQ7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRNb3VzZUV2ZW50KCkge1xuICAgIHJldHVybiBtb3VzZUV2ZW50UG9pbnQ7XG4gIH1cblxuICBmdW5jdGlvbiByZXNldElucHV0cygpIHtcbiAgICBrZXlzUHJlc3NlZCA9IFtdO1xuICAgIG1vdXNlRXZlbnRQb2ludCA9IHVuZGVmaW5lZDtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAga2V5RG93bjoga2V5RG93bixcbiAgICBrZXlVcDoga2V5VXAsXG4gICAgZ2V0S2V5c1ByZXNzZWQ6IGdldEtleXNQcmVzc2VkLFxuICAgIG1vdXNlVXA6IG1vdXNlVXAsXG4gICAgZ2V0TW91c2VFdmVudDogZ2V0TW91c2VFdmVudCxcbiAgICByZXNldElucHV0czogcmVzZXRJbnB1dHNcbiAgfVxuXG59KSgpO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgJy4vc3R5bGVzL2luZGV4LmNzcyc7XG5cbmltcG9ydCB7IEFzc2V0cyB9IGZyb20gJy4vYXNzZXRfbWFuYWdlcic7XG5pbXBvcnQgVGlsZSBmcm9tICcuL3RpbGUnO1xuaW1wb3J0IE1hcCBmcm9tICcuL21hcCc7XG5pbXBvcnQgRW50aXR5IGZyb20gJy4vZW50aXR5JztcbmltcG9ydCB7IHRpbGVJbWFnZVBhdGhzLCBtb2JpbGVEZWZzIH0gZnJvbSAnLi91dGlsJztcbmltcG9ydCB7IElucHV0IH0gZnJvbSAnLi9pbnB1dCc7XG5cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBmdW5jdGlvbigpIHtcbiAgY29uc29sZS5sb2coJ1Byb3htYSBSZXZlcmllIGFwcHJvYWNoZXMhJyk7XG5cbiAgbGV0IHRpY2tMZW5ndGggPSA1MDtcblxuICB2YXIgdmlld3BvcnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmlld3BvcnQtY2FudmFzJyk7XG4gIHZhciB2aWV3cG9ydENvbnRleHQgPSB2aWV3cG9ydC5nZXRDb250ZXh0KCcyZCcpO1xuICBsZXQgdmlld3BvcnRXaWR0aCA9IDYwMCxcbiAgICB2aWV3cG9ydEhlaWdodCA9IDQwMDtcbiAgdmlld3BvcnQud2lkdGggPSB2aWV3cG9ydFdpZHRoO1xuICB2aWV3cG9ydC5oZWlnaHQgPSB2aWV3cG9ydEhlaWdodDtcblxuICBsZXQgbWFwU2l6ZSA9IDEwO1xuXG4gIGxldCB0aWxlcyA9IHRpbGVJbWFnZVBhdGhzLm1hcCh0aWxlSW1hZ2VQYXRoID0+IHtcbiAgICByZXR1cm4gbmV3IFRpbGUoW3RpbGVJbWFnZVBhdGhdKTtcbiAgfSk7XG5cbiAgbGV0IG1hcCA9IG5ldyBNYXAodGlsZXMsIG1hcFNpemUpO1xuXG4gIGxldCBtb2JpbGVzID0gbW9iaWxlRGVmcy5tYXAobW9iaWxlRGVmID0+IHtcbiAgICByZXR1cm4gbmV3IEVudGl0eShtb2JpbGVEZWYsIG1hcCk7XG4gIH0pO1xuXG4gIGNvbnNvbGUubG9nKG1vYmlsZXMpO1xuXG4gIEFzc2V0cy5sb2FkQXNzZXRzKFsuLi50aWxlcywgLi4ubW9iaWxlc10sICgpID0+IHtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZy1pbWFnZXMtbWVzc2FnZScpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW1hZ2VzLWxvYWRlZC1tZXNzYWdlJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpO1xuXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBsZXQgdmlld09mZnNldFggPSBtYXAubWFwQ2FudmFzLndpZHRoIC8gMiAtIHZpZXdwb3J0V2lkdGggLyAyO1xuICAgICAgbGV0IHZpZXdPZmZzZXRZID0gbWFwLm1hcENhbnZhcy5oZWlnaHQgLyAyIC0gdmlld3BvcnRIZWlnaHQgLyAyO1xuXG4gICAgICBkb1RpY2sobWFwLCB2aWV3T2Zmc2V0WCwgdmlld09mZnNldFkpO1xuICAgIH0sIHRpY2tMZW5ndGgpO1xuICB9KTtcblxuICBmdW5jdGlvbiBkb1RpY2sobWFwLCB2aWV3T2Zmc2V0WCwgdmlld09mZnNldFkpIHtcbiAgICAvLyBjb25zb2xlLmxvZygndGljaycpO1xuXG4gICAgbGV0IG1vdXNlRXZlbnQgPSBJbnB1dC5nZXRNb3VzZUV2ZW50KCk7XG4gICAgaWYgKG1vdXNlRXZlbnQgIT0gdW5kZWZpbmVkKSB7XG4gICAgICBsZXQgbWFwUG9zaXRpb24gPSBnZXRDdXJzb3JNYXBQb3NpdGlvbihcbiAgICAgICAgdmlld09mZnNldFgsXG4gICAgICAgIHZpZXdPZmZzZXRZLFxuICAgICAgICBtb3VzZUV2ZW50XG4gICAgICApO1xuICAgICAgbGV0IHRpbGVQb3NpdGlvbiA9IGdldEN1cnNvclRpbGVQb3NpdGlvbihtYXAsIG1hcFBvc2l0aW9uKTtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiXCIpO1xuICAgICAgLy8gY29uc29sZS5sb2coYGNhbnZhcyBwb3NpdGlvbjogJHttb3VzZUV2ZW50Lnh9LCAke21vdXNlRXZlbnQueX1gKTtcbiAgICAgIC8vIGNvbnNvbGUubG9nKGBtYXAgcG9zaXRpb246ICR7bWFwUG9zaXRpb24ueH0sICR7bWFwUG9zaXRpb24ueX1gKTtcbiAgICAgIC8vIGNvbnNvbGUubG9nKGB0aWxlIHBvc2l0aW9uOiAke3RpbGVQb3NpdGlvbi54fSwgJHt0aWxlUG9zaXRpb24ueX1gKTtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiXCIpO1xuXG4gICAgICBtb2JpbGVzLmZvckVhY2gobW9iaWxlID0+IHtcbiAgICAgICAgbW9iaWxlLnJlc3BvbmRUb01vdXNlKHtcbiAgICAgICAgICBtYXBDb29yZDogbWFwUG9zaXRpb24sXG4gICAgICAgICAgdGlsZUNvb3JkczogdGlsZVBvc2l0aW9uXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgbW9iaWxlcy5mb3JFYWNoKG1vYmlsZSA9PiB7XG4gICAgICBtb2JpbGUudGljaygpO1xuICAgIH0pO1xuXG4gICAgdmlld3BvcnRDb250ZXh0LmNsZWFyUmVjdCgwLCAwLCB2aWV3cG9ydFdpZHRoLCB2aWV3cG9ydEhlaWdodCk7XG4gICAgdmlld3BvcnRDb250ZXh0LmRyYXdJbWFnZShcbiAgICAgIG1hcC5tYXBDYW52YXMsXG4gICAgICB2aWV3T2Zmc2V0WCxcbiAgICAgIHZpZXdPZmZzZXRZLFxuICAgICAgdmlld3BvcnRXaWR0aCxcbiAgICAgIHZpZXdwb3J0SGVpZ2h0LFxuICAgICAgMCxcbiAgICAgIDAsXG4gICAgICB2aWV3cG9ydFdpZHRoLFxuICAgICAgdmlld3BvcnRIZWlnaHRcbiAgICApO1xuXG4gICAgbW9iaWxlcy5mb3JFYWNoKG1vYmlsZSA9PiB7XG4gICAgICB2aWV3cG9ydENvbnRleHQuZHJhd0ltYWdlKFxuICAgICAgICBtb2JpbGUuaW1hZ2UsXG4gICAgICAgIG1vYmlsZS5mcmFtZVhPcmlnaW4sXG4gICAgICAgIG1vYmlsZS5mcmFtZVlPcmlnaW4sXG4gICAgICAgIG1vYmlsZS5mcmFtZVdpZHRoLFxuICAgICAgICBtb2JpbGUuZnJhbWVIZWlnaHQsXG4gICAgICAgIG1vYmlsZS5sb2NhdGlvbi54IC0gdmlld09mZnNldFgsXG4gICAgICAgIG1vYmlsZS5sb2NhdGlvbi55IC0gdmlld09mZnNldFksXG4gICAgICAgIG1vYmlsZS5mcmFtZVdpZHRoLFxuICAgICAgICBtb2JpbGUuZnJhbWVIZWlnaHRcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBJbnB1dC5yZXNldElucHV0cygpO1xuXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBkb1RpY2sobWFwLCB2aWV3T2Zmc2V0WCwgdmlld09mZnNldFkpO1xuICAgIH0sIHRpY2tMZW5ndGgpO1xuICB9XG5cbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGV2ZW50ID0+IHtcbiAgICBJbnB1dC5rZXlEb3duKGV2ZW50LmtleSk7XG4gIH0pO1xuXG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgZXZlbnQgPT4ge1xuICAgIElucHV0LmtleVVwKGV2ZW50LmtleSk7XG4gIH0pO1xuXG4gIHZpZXdwb3J0LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBldmVudCA9PiB7XG4gICAgSW5wdXQubW91c2VVcChnZXRDdXJzb3JDYW52YXNQb3NpdGlvbih2aWV3cG9ydCwgZXZlbnQpKTtcbiAgfSk7XG5cbiAgZnVuY3Rpb24gZ2V0Q3Vyc29yQ2FudmFzUG9zaXRpb24oY2FudmFzLCBwb3NpdGlvbikge1xuICAgIGxldCByZWN0ID0gY2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIGxldCB4ID0gcG9zaXRpb24uY2xpZW50WCAtIHJlY3QubGVmdDtcbiAgICBsZXQgeSA9IHBvc2l0aW9uLmNsaWVudFkgLSByZWN0LnRvcDtcbiAgICByZXR1cm4geyB4OiB4LCB5OiB5IH07XG4gIH1cblxuICBmdW5jdGlvbiBnZXRDdXJzb3JNYXBQb3NpdGlvbih2aWV3T2Zmc2V0WCwgdmlld09mZnNldFksIHBvc2l0aW9uKSB7XG4gICAgbGV0IG1vdXNlTWFwWCA9IHZpZXdPZmZzZXRYICsgcG9zaXRpb24ueDtcbiAgICBsZXQgbW91c2VNYXBZID0gdmlld09mZnNldFkgKyBwb3NpdGlvbi55O1xuICAgIHJldHVybiB7IHg6IG1vdXNlTWFwWCwgeTogbW91c2VNYXBZIH07XG4gIH1cblxuICBmdW5jdGlvbiBnZXRDdXJzb3JUaWxlUG9zaXRpb24obWFwLCBwb3NpdGlvbikge1xuICAgIGxldCBoYWxmVGlsZVdpZHRoID0gbWFwLnRpbGVXaWR0aCAvIDI7XG4gICAgbGV0IGhhbGZUaWxlSGVpZ2h0ID0gbWFwLnRpbGVIZWlnaHQgLyAyO1xuICAgIGxldCBoYWxmTWFwU2l6ZSA9IG1hcC5tYXBTaXplIC8gMjtcbiAgICBsZXQgdGlsZVggPVxuICAgICAgKHBvc2l0aW9uLnggLyBoYWxmVGlsZVdpZHRoICsgcG9zaXRpb24ueSAvIGhhbGZUaWxlSGVpZ2h0KSAvIDIgLVxuICAgICAgaGFsZk1hcFNpemU7XG4gICAgbGV0IHRpbGVZID1cbiAgICAgIChwb3NpdGlvbi55IC8gaGFsZlRpbGVIZWlnaHQgLSBwb3NpdGlvbi54IC8gaGFsZlRpbGVXaWR0aCkgLyAyICtcbiAgICAgIGhhbGZNYXBTaXplO1xuICAgIHJldHVybiB7IHg6IE1hdGguZmxvb3IodGlsZVgpLCB5OiBNYXRoLmZsb29yKHRpbGVZKSB9O1xuICB9XG59KTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDbENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUNUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUNuQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQ3BDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDL0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQzFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUNwREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///0\n")},,function(module,exports,__webpack_require__){eval("// extracted by mini-css-extract-plugin//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMi5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9zdHlsZXMvaW5kZXguY3NzPzU5ZDAiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gZXh0cmFjdGVkIGJ5IG1pbmktY3NzLWV4dHJhY3QtcGx1Z2luIl0sIm1hcHBpbmdzIjoiQUFBQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///2\n")}]);